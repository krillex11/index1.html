<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Realtime Firebase App</title>
</head>
<body>

<h2>–†–µ–∞–∫—Ç–∏–≤–Ω–∞—è –ª–µ–Ω—Ç–∞</h2>

<input type="text" id="postText" placeholder="–í–≤–µ–¥–∏—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏–µ">
<button id="sendBtn">–û—Ç–ø—Ä–∞–≤–∏—Ç—å</button>

<hr>

<div id="posts"></div>

<script type="module">

import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { 
  getFirestore, 
  collection, 
  addDoc, 
  onSnapshot,
  query,
  orderBy,
  updateDoc,
  doc,
  increment,
  serverTimestamp
} from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyDeTACUBfB-XWhgtTtYqwavqHOkPcvLvTM",
  authDomain: "krillex-a57aa.firebaseapp.com",
  projectId: "krillex-a57aa",
  storageBucket: "krillex-a57aa.firebasestorage.app",
  messagingSenderId: "559983149303",
  appId: "1:559983149303:web:18d360a1775d3a81e4d3f2",
  measurementId: "G-HKR3DZYVD8"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

// üìå –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –ø–æ—Å—Ç–∞
document.getElementById("sendBtn").addEventListener("click", async () => {

  const text = document.getElementById("postText").value;

  await addDoc(collection(db, "posts"), {
    text: text,
    likes: 0,
    timestamp: serverTimestamp()
  });

  document.getElementById("postText").value = "";
});

// üì° –†–µ–∞–∫—Ç–∏–≤–Ω—ã–π —Å–ª—É—à–∞—Ç–µ–ª—å
const q = query(collection(db, "posts"), orderBy("timestamp", "desc"));

onSnapshot(q, (snapshot) => {

  const container = document.getElementById("posts");
  container.innerHTML = "";

  snapshot.forEach((docSnap) => {

    const data = docSnap.data();

    const div = document.createElement("div");
    div.innerHTML = `
      <p>${data.text}</p>
      <button data-id="${docSnap.id}">üëç ${data.likes}</button>
      <hr>
    `;

    container.appendChild(div);
  });


  document.querySelectorAll("button[data-id]").forEach(btn => {
    btn.addEventListener("click", async () => {
      const postRef = doc(db, "posts", btn.dataset.id);
      await updateDoc(postRef, {
        likes: increment(1)
      });
    });
  });

});

</script>

</body>
</html>
